<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒˆãƒ©ãƒ³ã‚·ãƒ¼ãƒãƒ¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: sans-serif;
  text-align: center;
  padding: 30px;
}
button {
  font-size: 24px;
  padding: 20px 40px;
  touch-action: manipulation;
}
</style>
</head>
<body>

<h1>æŠ¼ã—ã¦è©±ã™</h1>
<button id="talk">ğŸ¤ æŠ¼ã—ã¦è©±ã™</button>
<p id="status">å¾…æ©Ÿä¸­</p>

<script>
let audioCtx;
let mic;
let gain;

const btn = document.getElementById("talk");
const status = document.getElementById("status");

// æŠ¼ã—ãŸç¬é–“
btn.addEventListener("touchstart", start, { passive:false });
btn.addEventListener("mousedown", start);

// é›¢ã—ãŸç¬é–“
btn.addEventListener("touchend", stop);
btn.addEventListener("mouseup", stop);

async function start(e) {
  e.preventDefault();

  status.textContent = "ãƒã‚¤ã‚¯ON";

  if (!audioCtx) {
    audioCtx = new AudioContext();
  }

  // ã‚¹ãƒãƒ›ã¯æ˜ç¤ºçš„ã«resumeå¿…é ˆ
  await audioCtx.resume();

  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

  mic = audioCtx.createMediaStreamSource(stream);
  gain = audioCtx.createGain();
  gain.gain.value = 1.0;

  mic.connect(gain);
  gain.connect(audioCtx.destination);
}

function stop() {
  status.textContent = "å¾…æ©Ÿä¸­";

  if (audioCtx) {
    audioCtx.close();
    audioCtx = null;
  }
}
</script>

</body>
</html>
