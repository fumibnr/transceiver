<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒˆãƒ©ãƒ³ã‚·ãƒ¼ãƒãƒ¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: sans-serif;
  text-align: center;
  padding: 30px;
}
button {
  font-size: 24px;
  padding: 20px 40px;
}
</style>
</head>
<body>

<h1>æŠ¼ã—ã¦è©±ã™</h1>
<button id="talk">ğŸ¤ æŠ¼ã—ã¦è©±ã™</button>
<p id="status">å¾…æ©Ÿä¸­</p>

<script>
const btn = document.getElementById("talk");
const status = document.getElementById("status");

let audioCtx;
let mic;
let gainNode;
let stream;
let on = false;

btn.onclick = async () => {
  if (!on) {
    status.textContent = "ãƒã‚¤ã‚¯ON";
    on = true;

    audioCtx = new AudioContext();
    await audioCtx.resume();

    stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mic = audioCtx.createMediaStreamSource(stream);

    gainNode = audioCtx.createGain();
    gainNode.gain.value = 4.0; // â† éŸ³é‡ãƒ–ãƒ¼ã‚¹ãƒˆï¼ˆé‡è¦ï¼‰

    mic.connect(gainNode);
    gainNode.connect(audioCtx.destination);

  } else {
    status.textContent = "å¾…æ©Ÿä¸­";
    on = false;

    stream.getTracks().forEach(t => t.stop());
    audioCtx.close();
  }
};
</script>

</body>
</html>
